# LeRobot Scratch Environment

Experimental repository for working with the [LeRobot library](https://github.com/huggingface/lerobot) and SO-100 robot arms.

## Quick Start

1. **Set up USB devices (Windows + WSL):**
   ```bash
   # On Windows (as Administrator):
   win-share-usb.cmd

   # In WSL, verify devices:
   ./wsl-share-usb.sh
   ```

2. **Activate virtual environment:**
   ```bash
   source venv/bin/activate
   ```

3. **Auto-configure hardware:**
   ```bash
   python autoconfigure.py
   ```

4. **Run experiments:**
   ```bash
   python scratch.py
   ```

## Hardware Configuration

### Automatic Configuration (`autoconfigure.py`)

The `autoconfigure.py` script automatically detects your SO-100 robots and USB cameras, then creates a `config.json` file with the correct device paths.

**How it works:**

1. **Detects robot arms** by serial number:
   - Follower arm: Serial ending with `764`
   - Leader arm: Serial ending with `835`
   - Scans `/dev/ttyUSB*` and `/dev/ttyACM*` devices
   - Uses `udevadm` to read serial numbers

2. **Detects cameras** by model name:
   - Overhead camera: Nuroum V11 → `base_0_rgb`
   - Wrist camera: USB2.0_CAM1 (ARC) → `left_wrist_0_rgb`
   - Scans `/dev/video*` devices
   - Uses `v4l2-ctl` to read camera info
   - Avoids duplicates (each camera exposes multiple `/dev/videoX` devices)

3. **Creates `config.json`** with detected device paths and settings

**Run autoconfigure:**
```bash
python autoconfigure.py
```

Example output:
```
============================================================
Auto-configuring SO100 LeRobot setup
============================================================

✓ Found follower arm: /dev/ttyACM1 (serial: 3140364A3335764)
✓ Found leader arm: /dev/ttyACM0 (serial: 31403643313E835)
✓ Found overhead camera: /dev/video2 (Nuroum V11: Nuroum V11)
✓ Found wrist camera: /dev/video0 (USB2.0_CAM1: USB2.0_CAM1)

✓ Created config.json
```

### Configuration File (`config.json`)

The `config.json` file stores hardware device paths and settings. It's automatically generated by `autoconfigure.py`, but can be manually edited if needed.

**Structure:**
```json
{
  "leader": {
    "port": "/dev/ttyACM0",
    "id": "leader_so100"
  },
  "follower": {
    "port": "/dev/ttyACM1",
    "id": "follower_so100"
  },
  "cameras": {
    "left_wrist_0_rgb": {
      "index_or_path": "/dev/video0",
      "width": 640,
      "height": 480,
      "fps": 30,
      "description": "USB2.0_CAM1: USB2.0_CAM1 (wrist)"
    },
    "base_0_rgb": {
      "index_or_path": "/dev/video2",
      "width": 640,
      "height": 360,
      "fps": 30,
      "description": "Nuroum V11: Nuroum V11 (overhead)"
    }
  }
}
```

**Fields:**
- `leader.port` / `follower.port`: Serial device path for robot arms
- `leader.id` / `follower.id`: Identifier used by LeRobot
- `cameras.*.index_or_path`: Video device path
- `cameras.*.width/height/fps`: Camera resolution and frame rate
- `cameras.*.description`: Human-readable camera description

**Note:** Device paths (like `/dev/ttyACM0`, `/dev/video0`) can change between reboots or when USB devices are reconnected. Re-run `autoconfigure.py` if devices stop working.

## USB Device Sharing (Windows + WSL)

When running WSL on Windows, USB devices need to be explicitly shared from Windows to WSL.

### Windows Script (`win-share-usb.cmd`)

Shares specific USB devices with WSL:
```cmd
# Starts usbipd service
# Binds USB devices on specific bus IDs (12-3, 12-4, 13-3, 13-4, 6-7)
# Attaches them to WSL
```

**Run as Administrator:**
```bash
win-share-usb.cmd
```

### WSL Verification (`wsl-share-usb.sh`)

Lists USB devices visible in WSL to verify the Windows script worked:
```bash
./wsl-share-usb.sh
```

**Reference:** https://learn.microsoft.com/en-us/windows/wsl/connect-usb

### Troubleshooting USB Issues

If devices aren't detected:
1. Run `win-share-usb.cmd` as Administrator in Windows
2. Verify with `./wsl-share-usb.sh` in WSL
3. Check user permissions: `sudo usermod -a -G dialout,video $USER`
4. Log out and back in (for group changes to take effect)
5. Check USB connection: `lsusb` and `ls /dev/tty* /dev/video*`
6. Re-run `python autoconfigure.py`

## Installation

### Python Environment

This project uses Python 3.12.3 with a virtual environment:

```bash
# Create virtual environment (already done)
python3 -m venv venv

# Activate
source venv/bin/activate

# Install LeRobot
pip install 'lerobot'
pip install 'lerobot[pi0]'
```

## Project Structure

- `scratch.py` - Main experimental script
- `autoconfigure.py` - Hardware auto-detection script
- `config.json` - Hardware configuration (auto-generated)
- `win-share-usb.cmd` - Windows USB sharing script
- `wsl-share-usb.sh` - WSL USB verification script
- `venv/` - Python virtual environment

## Usage

The main entry point is `scratch.py`, which currently demonstrates loading LeRobot datasets. Modify this file to experiment with different LeRobot features like teleoperation, recording, or robot control.

